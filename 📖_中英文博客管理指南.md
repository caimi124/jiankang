# 📖 中英文博客管理指南

## ✅ 修复完成总结（2025-10-30）

### 🔧 已修复的问题：
1. ✅ 英文博客页面的中文文字已改为英文
2. ✅ Sanity数据库中所有文章已添加 `language` 字段
3. ✅ 博客查询已完全分离中英文逻辑
4. ✅ 移除了重复的helper函数定义
5. ✅ 没有发现带 `-zh` 后缀的混乱数据

---

## 🏗️ 当前系统架构

### **英文博客系统** 🇺🇸
- **URL路径**: `/blog/*`
- **Sanity文章**: 5篇（存储在CMS中，带 `language: "en"` 字段）
- **本地静态文章**: 7篇（硬编码在 `app/blog/page.tsx`）
- **总共**: 12篇英文文章

### **中文博客系统** 🇨🇳
- **URL路径**: `/zh/blog/*`
- **Sanity文章**: 0篇（目前为空，需要您添加）
- **查询函数**: 已准备好，等待内容

---

## 📝 如何管理中英文博客

### **方案1：使用Sanity CMS管理（推荐）**

#### 1️⃣ 添加英文文章到Sanity
```bash
# 登录Sanity Studio
cd e:\jiangkang\sanity
npm run dev
# 访问 http://localhost:3333
```

**创建文章时必须设置：**
- ✅ `title`: 英文标题
- ✅ `slug`: URL友好的slug（不要加 `-zh` 后缀！）
- ✅ `language`: 选择 "en"
- ✅ `excerpt`: 文章摘要
- ✅ `content`: 文章正文
- ✅ `status`: "published"
- ✅ `category`: 选择分类
- ✅ `tags`: 添加标签

#### 2️⃣ 添加中文文章到Sanity
```bash
# 同样登录Sanity Studio
cd e:\jiangkang\sanity
npm run dev
```

**创建中文文章时必须设置：**
- ✅ `title`: 中文标题（例如："红洋葱vs白洋葱：哪个更健康？"）
- ✅ `slug`: **使用与英文相同的slug**（例如："red-onion-vs-white-onion-health-benefits"）
  - ⚠️ **注意：不要添加 `-zh` 后缀！**
- ✅ `language`: 选择 "zh"
- ✅ `excerpt`: 中文摘要
- ✅ `content`: 中文正文
- ✅ `status`: "published"
- ✅ `category`: 中文分类
- ✅ `tags`: 中文标签

**重要规则：**
- ✅ 中英文使用相同的slug，通过 `language` 字段区分
- ✅ URL自动路由：
  - 英文：`/blog/red-onion-vs-white-onion-health-benefits`
  - 中文：`/zh/blog/red-onion-vs-white-onion-health-benefits`
- ❌ 不要在slug中添加 `-en` 或 `-zh` 后缀

---

### **方案2：使用脚本批量添加**

#### 创建英文文章脚本示例：
```javascript
// scripts/add-blog-post-en.js
const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: '13rzzwgz',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: 'YOUR_TOKEN_HERE'
});

async function addEnglishPost() {
  const post = await client.create({
    _type: 'blogPost',
    title: 'Your English Title',
    slug: {
      _type: 'slug',
      current: 'your-article-slug'
    },
    language: 'en',  // 英文
    excerpt: 'Your excerpt here...',
    content: [
      {
        _type: 'block',
        children: [{_type: 'span', text: 'Your content here...'}]
      }
    ],
    publishedAt: new Date().toISOString(),
    readTime: 8,
    featured: false,
    status: 'published',
    author: { _ref: 'AUTHOR_REF' },
    category: { _ref: 'CATEGORY_REF' },
    tags: [{ _ref: 'TAG_REF_1' }]
  });
  
  console.log('✅ 英文文章已创建:', post._id);
}

addEnglishPost();
```

#### 创建中文文章脚本示例：
```javascript
// scripts/add-blog-post-zh.js
const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: '13rzzwgz',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: 'YOUR_TOKEN_HERE'
});

async function addChinesePost() {
  const post = await client.create({
    _type: 'blogPost',
    title: '您的中文标题',
    slug: {
      _type: 'slug',
      current: 'your-article-slug'  // 与英文相同！
    },
    language: 'zh',  // 中文
    excerpt: '您的中文摘要...',
    content: [
      {
        _type: 'block',
        children: [{_type: 'span', text: '您的中文内容...'}]
      }
    ],
    publishedAt: new Date().toISOString(),
    readTime: 8,
    featured: false,
    status: 'published',
    author: { _ref: 'AUTHOR_REF' },
    category: { _ref: 'CATEGORY_REF' },
    tags: [{ _ref: 'TAG_REF_1' }]
  });
  
  console.log('✅ 中文文章已创建:', post._id);
}

addChinesePost();
```

---

## 🎯 翻译英文文章到中文的正确流程

### **步骤1：准备翻译内容**
1. 选择一篇英文文章（例如：Red Onion vs White Onion）
2. 将标题、摘要、正文翻译成中文
3. 保持相同的文章结构和格式

### **步骤2：在Sanity创建中文版本**
```javascript
// scripts/translate-article.js
const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: '13rzzwgz',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: 'sk7J8olzdUL0U66G5UXJXrhATzLAQ8LxVLqFpkcfbSL5Nusr5MT7kc0QRBdU49YLVgSbgryxhk4gEmqUghhZ5haAym9DvhTubA2Hu7Z2nnG18zOXN0oDegpO8t6MhPcEzRsniIwiRgPSQQsZlqgjJZ6aX7YqiFlH67iH6pC9vWEontHNkWAp'
});

async function translateArticleToZh() {
  try {
    // 1. 获取英文原文（如果在Sanity中）
    const enPost = await client.fetch(`*[_type == "blogPost" && slug.current == "red-onion-vs-white-onion-health-benefits" && language == "en"][0]`);
    
    if (!enPost) {
      console.log('⚠️ 未找到英文原文');
      return;
    }
    
    // 2. 创建中文翻译版本
    const zhPost = await client.create({
      _type: 'blogPost',
      title: '红洋葱vs白洋葱：哪个更健康？（科学对比）',
      slug: {
        _type: 'slug',
        current: enPost.slug.current  // 使用相同的slug！
      },
      language: 'zh',  // 设置为中文
      excerpt: '红洋葱和白洋葱，哪个更健康？发现抗氧化剂、槲皮素、花青素、消化益处的关键差异，以及如何使用它们以获得最大健康效益。',
      content: [
        {
          _type: 'block',
          style: 'h2',
          children: [{_type: 'span', text: '快速答案：红洋葱在抗氧化剂方面胜出，白洋葱在消化性方面胜出'}]
        },
        // ... 添加更多中文内容块
      ],
      publishedAt: new Date().toISOString(),
      readTime: 8,
      featured: true,
      status: 'published',
      author: enPost.author,  // 使用相同作者
      category: enPost.category,  // 或创建中文分类
      tags: enPost.tags  // 或创建中文标签
    });
    
    console.log('✅ 中文翻译已创建:', zhPost._id);
    console.log(`   英文URL: /blog/${enPost.slug.current}`);
    console.log(`   中文URL: /zh/blog/${zhPost.slug.current}`);
    
  } catch (error) {
    console.error('❌ 错误:', error.message);
  }
}

translateArticleToZh();
```

### **步骤3：运行脚本**
```bash
cd e:\jiangkang
node scripts/translate-article.js
```

---

## 🔍 验证文章是否正确

### **检查脚本**
```bash
# 运行检查脚本
cd e:\jiangkang
node scripts/check-blog-posts.js
```

### **访问页面验证**
- 英文博客列表：https://herbscience.shop/blog
- 中文博客列表：https://herbscience.shop/zh/blog
- 英文文章：https://herbscience.shop/blog/article-slug
- 中文文章：https://herbscience.shop/zh/blog/article-slug

---

## ⚠️ 常见错误与解决方法

### ❌ 错误1：URL带 `-zh` 后缀
**错误示例**：`/blog/article-slug-zh`

**原因**：在Sanity创建文章时，slug中包含了 `-zh` 后缀

**解决方法**：
1. 在Sanity Studio中找到该文章
2. 编辑slug，移除 `-zh` 后缀
3. 保存并重新部署

### ❌ 错误2：英文页面显示中文内容
**原因**：文章的 `language` 字段设置错误

**解决方法**：
```bash
# 运行修复脚本
node scripts/fix-language-field.js
```

### ❌ 错误3：中文页面找不到文章
**原因**：
1. 文章的 `language` 不是 "zh"
2. 或者 `status` 不是 "published"

**解决方法**：
1. 检查Sanity Studio中的文章设置
2. 确保 `language="zh"` 且 `status="published"`

---

## 🚀 部署更新

每次添加新文章后，需要重新部署：

```bash
# 方式1：推送到Git（自动部署）
git add .
git commit -m "Add new blog posts"
git push origin main

# 方式2：在Vercel手动触发部署
# 访问 https://vercel.com/dashboard
```

---

## 📊 当前数据库状态

### Sanity CMS 文章统计：
- 英文文章：5篇（全部带 `language: "en"`）
- 中文文章：0篇（等待添加）

### 本地静态文章（硬编码）：
- 7篇英文文章（在 `app/blog/page.tsx` 中）
- 建议：逐步迁移到Sanity进行统一管理

---

## 🛠️ 有用的脚本

### 检查所有文章
```bash
node scripts/check-blog-posts.js
```

### 添加language字段
```bash
node scripts/add-language-field-to-posts.js
```

### 翻译文章
```bash
node scripts/translate-article.js
```

---

## 📞 需要帮助？

如果遇到问题：
1. 运行 `node scripts/check-blog-posts.js` 检查数据库状态
2. 查看Sanity Studio: `cd sanity && npm run dev`
3. 查看构建日志：`npm run build`

---

## ✅ 最佳实践总结

1. **语言分离**：通过 `language` 字段区分，不在slug中添加后缀
2. **相同slug**：中英文文章使用相同的slug，URL通过路径前缀区分
3. **统一管理**：尽量使用Sanity CMS管理所有文章
4. **定期检查**：使用脚本定期检查数据库状态
5. **测试验证**：添加文章后总是访问URL进行验证

---

**日期**: 2025-10-30  
**状态**: ✅ 系统已修复并优化  
**下一步**: 开始添加中文翻译文章

