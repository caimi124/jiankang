# 📘 中英文博客管理指南

## 🎯 系统架构说明

您的网站现在有**完全独立**的中英文博客系统，遵循国际化最佳实践。

### **URL结构**
- ✅ **英文博客**: `https://herbscience.shop/blog/{slug}`
- ✅ **中文博客**: `https://herbscience.shop/zh/blog/{slug}`

**注意**: Slug（URL路径）**不需要**添加 `-zh` 后缀！中英文文章使用**相同的slug**，但通过 `language` 字段区分。

---

## 📊 Sanity CMS 数据结构

### **1. 博客文章 (blogPost)**

每篇博客文章**必须**包含以下字段：

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| `title` | String | ✅ | 文章标题 | "Red Onion vs White Onion" / "红洋葱vs白洋葱" |
| `slug` | Slug | ✅ | URL路径（不要加-zh后缀） | `red-onion-vs-white-onion-health-benefits` |
| `language` | String | ✅ | 语言标识 | `"en"` 或 `"zh"` |
| `excerpt` | Text | ✅ | 摘要 | 文章简短描述 |
| `content` | Portable Text | ✅ | 正文内容 | 使用Sanity编辑器编写 |
| `status` | String | ✅ | 发布状态 | `"published"` 或 `"draft"` |
| `publishedAt` | DateTime | ✅ | 发布日期 | 2025-01-27 |
| `featured` | Boolean | ❌ | 是否为精选文章 | `true` / `false` |
| `author` | Reference | ✅ | 作者 | 引用到 `author` 文档 |
| `category` | Reference | ✅ | 分类 | 引用到 `category` 文档 |
| `tags` | Array | ❌ | 标签 | 引用到 `tag` 文档数组 |
| `readTime` | Number | ✅ | 阅读时长（分钟） | `8` |
| `seoTitle` | String | ❌ | SEO标题 | 用于搜索引擎优化 |
| `seoDescription` | Text | ❌ | SEO描述 | 用于搜索引擎优化 |
| `featured_image` | Image | ❌ | 特色图片 | 文章配图 |

### **2. 分类 (category)**

每个分类**必须**包含以下字段：

| 字段 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| `title` | String | ✅ | 分类名称 | "Herbal Guides" / "生活方式" |
| `slug` | Slug | ✅ | URL路径 | `herbal-guides` / `lifestyle` |
| `language` | String | ✅ | 语言标识 | `"en"` 或 `"zh"` |
| `description` | Text | ❌ | 分类描述 | 分类简介 |

**当前分类列表**:
- ✅ **英文分类**:
  - `Herb Safety` (language: "en")
  - `Herbal Guides` (language: "en")
- ✅ **中文分类**:
  - `生活方式` (language: "zh")
  - `科学研究` (language: "zh")

---

## ✍️ 如何创建新博客文章

### **方法1：直接在Sanity Studio创建（推荐）**

1. **登录Sanity Studio**: https://herbscience.sanity.studio
2. **创建新文章**:
   - 点击 "Blog Post" → "Create new"
   - 填写所有必填字段
   - **⚠️ 重点**: 设置正确的 `language` 字段
     - 英文文章: `language = "en"`
     - 中文文章: `language = "zh"`
   - **⚠️ 重点**: Slug **不要添加** `-zh` 后缀
     - ✅ 正确: `red-onion-vs-white-onion-health-benefits`
     - ❌ 错误: `red-onion-vs-white-onion-health-benefits-zh`
3. **发布**: 将 `status` 设置为 `"published"`

### **方法2：通过脚本批量创建**

如果需要批量导入文章，可以使用脚本：

```javascript
const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: '13rzzwgz',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: 'YOUR_SANITY_TOKEN'
});

async function createBlogPost() {
  const newPost = {
    _type: 'blogPost',
    title: '您的文章标题',
    slug: {
      _type: 'slug',
      current: 'your-article-slug'  // 不要添加-zh后缀
    },
    language: 'zh',  // 或 'en'
    excerpt: '文章摘要',
    content: [],  // Portable Text格式的内容
    status: 'published',
    publishedAt: new Date().toISOString(),
    readTime: 8,
    featured: false,
    author: {
      _type: 'reference',
      _ref: 'YOUR_AUTHOR_ID'
    },
    category: {
      _type: 'reference',
      _ref: 'YOUR_CATEGORY_ID'
    }
  };

  const result = await client.create(newPost);
  console.log('✅ 文章已创建:', result._id);
}

createBlogPost();
```

---

## 🌐 语言过滤机制

### **英文博客页面** (`/blog`)
- 查询函数: `getAllBlogPosts()`, `getFeaturedBlogPosts()`, `getBlogCategories()`
- 过滤条件: `language == "en"` 或 `!defined(language)`
- 只显示英文文章和英文分类

### **中文博客页面** (`/zh/blog`)
- 查询函数: `getAllBlogPostsZh()`, `getFeaturedBlogPostsZh()`, `getBlogCategoriesZh()`
- 过滤条件: `language == "zh"`
- 只显示中文文章和中文分类

---

## 📝 翻译工作流程

当您想把英文文章翻译成中文（或反向）时：

### **步骤1：在Sanity中创建新文章**
1. 打开Sanity Studio
2. 创建一篇**新的** Blog Post
3. 设置与原文**相同的slug**（不要加-zh后缀）
4. 设置 `language = "zh"` （如果翻译成中文）
5. 翻译所有内容：
   - `title` - 翻译标题
   - `excerpt` - 翻译摘要
   - `content` - 翻译正文
   - `seoTitle` 和 `seoDescription` - 翻译SEO信息

### **步骤2：关联相同的分类和标签**
- 使用对应语言的分类（中文文章→中文分类）
- 如果没有对应语言的分类，先创建分类

### **示例：翻译英文文章到中文**

**英文原文**:
```
title: "Red Onion vs White Onion: Which Is Healthier?"
slug: "red-onion-vs-white-onion-health-benefits"
language: "en"
category: "science" (英文分类)
```

**中文译文**:
```
title: "红洋葱 vs 白洋葱：哪个更健康？"
slug: "red-onion-vs-white-onion-health-benefits"  // 相同的slug
language: "zh"
category: "科学研究" (中文分类)
```

---

## 🚫 常见错误与解决方案

### ❌ **错误1：在Slug中添加-zh后缀**
```
slug: "article-name-zh"  // ❌ 错误
```

✅ **正确做法**:
```
slug: "article-name"  // ✅ 正确
language: "zh"
```

### ❌ **错误2：忘记设置language字段**
```
title: "红洋葱 vs 白洋葱"
language: undefined  // ❌ 错误 - 会被当作英文文章
```

✅ **正确做法**:
```
title: "红洋葱 vs 白洋葱"
language: "zh"  // ✅ 正确
```

### ❌ **错误3：中文文章使用英文分类**
```
language: "zh"
category: "Herbal Guides" (英文分类)  // ❌ 错误
```

✅ **正确做法**:
```
language: "zh"
category: "生活方式" (中文分类)  // ✅ 正确
```

---

## 🔍 验证文章是否正确

### **方法1：通过脚本验证**

运行以下脚本检查所有博客文章：

```bash
node scripts/fix-blog-zh-suffix.js
```

输出应该显示：
- ✅ 带-zh后缀的文章: 0 篇
- ✅ 所有文章都有正确的 `language` 字段

### **方法2：在网站上验证**

1. **英文博客页面** (https://herbscience.shop/blog)
   - 不应该出现中文分类名称
   - 不应该出现中文文章标题
   - 分类只应显示: "All Articles", "Herb Safety", "Herbal Guides"

2. **中文博客页面** (https://herbscience.shop/zh/blog)
   - 不应该出现英文分类名称
   - 不应该出现英文文章标题
   - 分类只应显示: "全部文章", "生活方式", "科学研究"

---

## 📁 代码文件结构

```
项目根目录/
├── app/
│   ├── blog/                    # 英文博客
│   │   ├── page.tsx            # 使用 getAllBlogPosts()
│   │   ├── BlogClient.tsx      # 英文UI组件
│   │   └── [slug]/             # 动态路由
│   │       └── page.tsx        
│   └── zh/
│       └── blog/               # 中文博客
│           ├── page.tsx        # 使用 getAllBlogPostsZh()
│           ├── ZhBlogClient.tsx # 中文UI组件
│           └── [slug]/         # 动态路由
│               └── page.tsx
├── lib/
│   └── sanity.ts               # Sanity查询函数
│       ├── getAllBlogPosts()           # 英文文章
│       ├── getFeaturedBlogPosts()      # 英文精选
│       ├── getBlogCategories()         # 英文分类
│       ├── getAllBlogPostsZh()         # 中文文章
│       ├── getFeaturedBlogPostsZh()    # 中文精选
│       └── getBlogCategoriesZh()       # 中文分类
└── scripts/
    ├── fix-blog-zh-suffix.js          # 检查和删除-zh后缀文章
    ├── check-categories.js            # 检查分类
    └── fix-categories-language.js     # 修复分类语言字段
```

---

## 🛠️ 维护脚本

### **1. 检查博客文章**
```bash
node scripts/fix-blog-zh-suffix.js
```
功能：
- 查找所有博客文章
- 识别带-zh后缀的文章
- 显示正常文章列表

### **2. 删除错误的-zh后缀文章**
```bash
node scripts/fix-blog-zh-suffix.js --delete
```
⚠️ **警告**: 此操作会永久删除带-zh后缀的文章，请谨慎使用！

### **3. 检查分类**
```bash
node scripts/check-categories.js
```
功能：
- 列出所有分类
- 识别中文分类
- 检查语言字段

### **4. 修复分类语言字段**
```bash
node scripts/fix-categories-language.js
```
功能：
- 为所有分类添加 `language` 字段
- 自动识别中英文分类
- 添加缺失的slug

---

## 📚 最佳实践

### ✅ **推荐做法**

1. **始终在Sanity Studio中设置 `language` 字段**
   - 英文文章: `language = "en"`
   - 中文文章: `language = "zh"`

2. **使用相同的slug，不要添加后缀**
   - 同一篇文章的中英文版本使用相同的slug
   - 通过 `language` 字段区分

3. **使用对应语言的分类和标签**
   - 英文文章 → 英文分类 (category with `language = "en"`)
   - 中文文章 → 中文分类 (category with `language = "zh"`)

4. **定期运行验证脚本**
   - 每次添加新文章后，运行 `node scripts/fix-blog-zh-suffix.js` 验证

5. **SEO优化**
   - 为每篇文章设置 `seoTitle` 和 `seoDescription`
   - 使用 `alternates.languages` 设置多语言链接关系

### ❌ **避免的做法**

1. ❌ 在slug中添加 `-zh`, `-en` 等后缀
2. ❌ 忘记设置 `language` 字段
3. ❌ 在中文文章中使用英文分类（或反过来）
4. ❌ 在客户端代码中通过标题判断语言（应该使用 `language` 字段）
5. ❌ 直接修改数据库而不通过Sanity Studio或脚本

---

## 🎓 学习资源

### **Sanity相关**
- [Sanity GROQ查询语言](https://www.sanity.io/docs/groq)
- [Sanity多语言内容管理](https://www.sanity.io/docs/localization)
- [Sanity Client API](https://www.sanity.io/docs/js-client)

### **Next.js国际化**
- [Next.js国际化文档](https://nextjs.org/docs/app/building-your-application/routing/internationalization)
- [Next.js多语言路由](https://nextjs.org/docs/pages/building-your-application/routing/internationalization)

---

## 📞 需要帮助？

如果遇到问题，请检查：

1. **Sanity连接问题**: 确保 `.env.local` 中的 `SANITY_API_TOKEN` 正确
2. **文章不显示**: 检查文章的 `status` 是否为 `"published"`
3. **分类显示错误**: 运行 `node scripts/check-categories.js` 检查分类配置
4. **语言过滤失效**: 确保所有文章和分类都设置了 `language` 字段

---

## 🎉 系统状态

当前状态：✅ **完全修复**

- ✅ 英文博客页面只显示英文内容
- ✅ 中文博客页面只显示中文内容
- ✅ 所有分类都有语言字段
- ✅ 查询函数正确区分语言
- ✅ 没有带-zh后缀的文章
- ✅ URL结构符合国际化标准

---

**创建时间**: 2025-10-30  
**最后更新**: 2025-10-30  
**维护者**: HerbScience开发团队

---

💡 **提示**: 将此文档保存在项目根目录，方便以后参考。如有任何疑问，请参考此文档或运行相关脚本验证。

